{% include './header.html' %}
    <style>
      body {
        background-color: #f8f9fa;
      }
      .menu-card {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        transition: 0.3s;
        background: #fff;
      }
      .menu-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      .menu-title {
        font-weight: 600;
      }
      .menu-description {
        font-size: 0.9rem;
        color: #6c757d;
      }
      .price {
        font-weight: 600;
        color: #0d6efd;
      }
    </style>

<div class="container py-6">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
  <h2 class="fw-bold mb-2 mb-md-0">üçΩÔ∏è Available Menu</h2>
  <form class="d-flex w-100 w-md-auto" role="search">
    <input id="menuSearch" class="form-control me-2" type="search" placeholder="Search menu..." aria-label="Search">
    <button class="btn btn-primary d-none d-md-inline" type="submit">Search</button>
  </form>
</div>

    <ul class="d-flex flex-wrap justify-content-start gap-2 mx-auto w-75 list-unstyled">
      <li>
        <a href='/menuList'><h5><span class="badge bg-secondary">All</span></h5></a>
      </li>
      {% for item in menu_count %}
        <li>
          <a href='/menuList/{{ item.menuType }}'>
            <h5><span class="badge bg-secondary">{{ item.menuType }} ({{ item.total }})</span></h5>
          </a>
        </li>
      {% empty %}
        <p class="text-muted">No menu items found.</p>
      {% endfor %}
    </ul>

  <div class="row g-4" id="menuContainer">
    {% for item in menus %}
    <div class="col-md-4 menu-item">
      <div class="menu-card p-3 h-100 d-flex flex-column">
        <img src="/media/menu/{{ item.menuName|slugify }}.jpg" 
             alt="{{ item.menuName }}" class="img-fluid mb-3 w-100 h-100" style=" object-fit: cover; border-radius: 8px;">
        <h5 class="menu-title">{{ item.menuName }}</h5>
        <p class="menu-description">{{ item.description }}</p>
        <div class="d-flex justify-content-between align-items-center mt-auto">
          <span class="price">${{ item.price }}</span>
          <div class="d-flex justify-content-between w-50">
            <span class="badge bg-success">{{ item.menuType }}</span>
            <span class="badge bg-secondary">{{ item.cookingTime }} min</span>
          
          </div>
          <button class="btn btn-success" onclick="addToCart('{{item.menuID}}','{{item.menuName}}','{{item.price}}')">Add</button>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-muted">No menu items found.</p>
    {% endfor %}
    <button class="btn btn-primary rounded-circle position-fixed shadow" style="bottom: 30px; right: 30px; width: 60px; height: 60px; font-size: 22px;" data-bs-toggle="modal" data-bs-target="#cartModal">
      üõí
      <span id="floating-cart-count"
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        0
      </span>
    </button>
    <!-- Cart Modal -->
    <form class="form" action="/createOrder/" method="post">
      {% csrf_token %}
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-end modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="cartModalLabel">üõí Your Cart</h5>
            <input type="hidden" name="cart_data" id="cart-data">
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="cart-items">
            <p class="text-muted text-center">No items in cart</p>
          </div>
          <div class="modal-footer d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Total: $<span id="cart-total">0.00</span></h5>
            <button class="btn btn-success" type="submit" id="checkout-btn" disabled>Order</button>
          </div>
        </div>
      </div>
    </div>
    </form>
</div>


</div>

<script>
  // üîç Live search filter
  const searchInput = document.getElementById('menuSearch');
  const menuItems = document.querySelectorAll('.menu-item');

  searchInput.addEventListener('keyup', function() {
    const filter = searchInput.value.toLowerCase();
    menuItems.forEach(item => {
      const name = item.querySelector('.menu-title').textContent.toLowerCase();
      item.style.display = name.includes(filter) ? 'block' : 'none';
    });
  });
let cart = [];

function addToCart(id,name, price) {
  const itemIndex = cart.findIndex(i => i.name === name);
  
  if (itemIndex > -1) {
    cart[itemIndex].qty += 1;
  } else {
    cart.push({id, name, price, qty: 1 });
  }

  updateCart();
}

function removeFromCart(name) {
  cart = cart.filter(i => i.name !== name);
  updateCart();
}

function updateCart() {
  const cartItemsDiv = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  const checkoutBtn = document.getElementById('checkout-btn');
  const floatingCount = document.getElementById('floating-cart-count');

  cartItemsDiv.innerHTML = '';
  let total = 0;

  if (cart.length === 0) {
    cartItemsDiv.innerHTML = '<p class="text-muted text-center">No items in cart</p>';
    checkoutBtn.disabled = true;
    floatingCount.textContent = 0;
  } else {
    checkoutBtn.disabled = false;
    cart.forEach(item => {
      total += item.price * item.qty;
      cartItemsDiv.innerHTML += `
        <div class="d-flex justify-content-between align-items-center border-bottom py-2">
          <div>
            <strong>${item.name}</strong><br>
            <small>$${item.price} √ó ${item.qty}</small>
          </div>
          <div class="text-end">
            <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart('${item.name}')">‚úï</button>
          </div>
        </div>
      `;
    });
    floatingCount.textContent = cart.length;
  }

  cartTotal.textContent = total.toFixed(2);
  document.querySelector(".form").addEventListener("submit", function (e) {
  const cartInput = document.getElementById("cart-data");
  cartInput.value = JSON.stringify(cart);
});
}
</script>
