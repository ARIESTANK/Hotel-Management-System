{% include './staffHeader.html' %}
<style>
body {
  background-color: #f8f9fa;
}

.table-wrapper {
  margin: 3% auto;
  width: 95%;
  max-width: 1200px;
  background: white;
  border-radius: 15px;
  padding: 2%;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
}

.table thead {
  background: linear-gradient(135deg, #007bff, #6610f2);
  color: white;
}

.table tbody tr:hover {
  background-color: #f2f6fc;
  transition: 0.3s;
}

.search-box {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.search-box input {
  flex: 1 1 200px;
  border-radius: 25px;
  padding: 0.5rem 1rem;
  border: 1px solid #ccc;
  transition: all 0.3s ease-in-out;
}

.search-box input:focus {
  box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
  border-color: #007bff;
}

.btn {
  border-radius: 8px;
}

.empty-message {
  text-align: center;
  color: #6c757d;
  font-style: italic;
  padding: 20px;
}

/* Responsive table wrapper */
.table-responsive {
  overflow-x: auto;
}

/* Adjust font size on smaller screens */
@media (max-width: 768px) {
  .table thead th {
    font-size: 0.85rem;
    padding: 0.5rem;
  }
  .table tbody td {
    font-size: 0.85rem;
    padding: 0.5rem;
  }
  .search-box input {
    width: 100%;
  }
  .search-box button {
    width: 100%;
  }
}
</style>

<div class="table-wrapper mt-5">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
    <h4 class="fw-bold text-primary mb-2 mb-md-0">
      <i class="bi bi-people-fill"></i> Staff Management
    </h4>
    <div class="search-box w-100 w-md-auto">
      <input type="text" id="searchInput" class="form-control" placeholder="🔍 Search staff by name...">
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStaffModal">
        <i class="bi bi-person-plus-fill"></i> Add Staff
      </button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-hover align-middle text-center">
      <thead>
        <tr>
          <th>Staff ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Joined On</th>
          <th>Payroll (MMK)</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="staffTableBody">
        {% for staff in staffs %}
        <tr>
          <td>{{ staff.staffID }}</td>
          <td class="fw-semibold text-primary">{{ staff.staffName }}</td>
          <td>{{ staff.staffEmail }}</td>
          <td><span class="badge bg-info text-dark">{{ staff.role }}</span></td>
          <td>{{ staff.created_at|date:"Y-m-d" }}</td>
          <td>{{ staff.payRoll|default:"-" }}</td>
          {% if staff.status == "free" %}
          <td><span class="badge bg-success">{{staff.status}}</span></td>
          {% else %}
          <td><span class="badge bg-danger">{{staff.status}}</span></td>
          {% endif %}
          <td>
            <button class="btn btn-sm btn-outline-success mb-1 mb-md-0" 
                  data-bs-toggle="modal" 
                  data-bs-target="#editStaffModal" 
                  data-id="{{ staff.staffID }}">
            <i class="bi bi-pencil-square"></i>
          </button>
            <button class="btn btn-sm btn-outline-danger">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="empty-message">
            <i class="bi bi-inbox fs-3 d-block"></i>
            No staff found.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Add Staff Modal (same as before, already responsive) -->
<div class="modal fade" id="addStaffModal" tabindex="-1" aria-labelledby="addStaffModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="addStaffModalLabel">
          <i class="bi bi-person-plus"></i> Add New Staff
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" id="editStaffForm" action="/createStaff/">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label fw-semibold">Full Name</label>
            <input type="text" class="form-control" name="staffName" placeholder="Enter full name" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Email</label>
            <input type="email" class="form-control" name="staffEmail" placeholder="example@mail.com" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Password</label>
            <input type="password" class="form-control" id="staffPassword" name="password" placeholder="Enter password" required readonly>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Role</label>
            <select class="form-select" id="staffRole" name="role" required>
              <option value="" disabled selected>-- Select Role --</option>
              <option value="Manager">Manager</option>
              <option value="Receptionist">Receptionist</option>
              <option value="Housekeeping">Housekeeping</option>
              <option value="Chef">Chef</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Payroll (MMK)</label>
            <input type="number" class="form-control" id="payRoll" name="payRoll" placeholder="Enter payroll amount" required readonly>
          </div>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">
            <i class="bi bi-check2-circle"></i> Create Staff
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Edit Staff Modal -->
<div class="modal fade" id="editStaffModal" tabindex="-1" aria-labelledby="editStaffModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="editStaffModalLabel">
          <i class="bi bi-pencil-square"></i> Edit Staff
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" id="editStaffForm" action="/updateStaff/">
        {% csrf_token %}
        <div class="modal-body">
          <input type="hidden" name="staffID" id="editStaffID">
          <div class="mb-3">
            <label class="form-label fw-semibold">Full Name</label>
            <input type="text" class="form-control" id="editStaffName" name="staffName" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Email</label>
            <input type="email" class="form-control" id="editStaffEmail" name="staffEmail" required>
          </div>
          <div class="mb-3">
          <label class="form-label fw-semibold">Password</label>
          <input type="password" class="form-control" id="editStaffPassword" name="password" placeholder="Password auto-filled" readonly>
        </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Role</label>
            <select class="form-select" id="editStaffRole" name="role" required>
              <option value="" disabled>-- Select Role --</option>
              <option value="Manager">Manager</option>
              <option value="Receptionist">Receptionist</option>
              <option value="Housekeeping">Housekeeping</option>
              <option value="Chef">Chef</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Payroll (MMK)</label>
            <input type="number" class="form-control" id="editPayRoll" name="payRoll" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Status</label>
            <select class="form-select" id="editStaffStatus" name="status" required>
              <option value="free">Free</option>
              <option value="busy">Busy</option>
            </select>
          </div>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-check2-square"></i> Update Staff
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
const searchInput = document.getElementById('searchInput');
const tableBody = document.getElementById('staffTableBody');

searchInput.addEventListener('keyup', () => {
  const filter = searchInput.value.toLowerCase();
  const rows = tableBody.getElementsByTagName('tr');
  Array.from(rows).forEach(row => {
    const nameCell = row.getElementsByTagName('td')[1];
    if (nameCell) {
      const name = nameCell.textContent.toLowerCase();
      row.style.display = name.includes(filter) ? '' : 'none';
    }
  });
});

document.addEventListener('DOMContentLoaded', function() {
  const roleSelect = document.getElementById('staffRole');
  const passwordInput = document.getElementById('staffPassword');
  const payrollInput = document.getElementById('payRoll');

  roleSelect.addEventListener('change', function() {
    const role = this.value;
    let defaultPassword = '';
    let defaultPayroll = '';

    switch (role) {
      case 'Manager':
        defaultPassword = 'Manager@123';
        defaultPayroll = 800000;
        break;
      case 'Receptionist':
        defaultPassword = 'receptionist@123';
        defaultPayroll = 600000;
        break;
      case 'Housekeeping':
        defaultPassword = 'housekeeping@123';
        defaultPayroll = 500000;
        break;
      case 'Chef':
        defaultPassword = 'Chef@123';
        defaultPayroll = 700000;
        break;
      case 'Others':
        defaultPassword = 'other@123';
        defaultPayroll = 600000;
        break;
    }

    passwordInput.value = defaultPassword;
    payrollInput.value = defaultPayroll;
  });
});

const editStaffModal = document.getElementById('editStaffModal');
const editStaffForm = document.getElementById('editStaffForm');

editStaffModal.addEventListener('show.bs.modal', function(event) {
  const button = event.relatedTarget;
  const staffID = button.getAttribute('data-id');

  // Fetch staff data from your backend via AJAX or embed data attributes
  // For simplicity, we can use data attributes or Django JSON
  const row = button.closest('tr');
  const name = row.cells[1].textContent.trim();
  const email = row.cells[2].textContent.trim();
  const role = row.cells[3].textContent.trim().toLowerCase(); // adjust if needed
  const payroll = row.cells[5].textContent.trim();
  const status = row.cells[6].textContent.trim().toLowerCase();

  // Fill the modal fields
  document.getElementById('editStaffID').value = staffID;
  document.getElementById('editStaffName').value = name;
  document.getElementById('editStaffEmail').value = email;
  // document.getElementById('editStaffPassword').value = password;
  document.getElementById('editStaffRole').value = role.charAt(0).toUpperCase() + role.slice(1);
  document.getElementById('editPayRoll').value = payroll.replace(/,/g,''); // remove commas
  document.getElementById('editStaffStatus').value = status;

  // Optional: auto-fill default password for role if desired
});

document.addEventListener('DOMContentLoaded', function() {
  // Add Staff modal auto-fill already exists
  const roleSelect = document.getElementById('staffRole');
  const passwordInput = document.getElementById('staffPassword');
  const payrollInput = document.getElementById('payRoll');

  roleSelect.addEventListener('change', function() {
    const role = this.value;
    let defaultPassword = '';
    let defaultPayroll = '';

    switch (role) {
      case 'Manager':
        defaultPassword = 'manager@123';
        defaultPayroll = 800000;
        break;
      case 'Receptionist':
        defaultPassword = 'receptionist@123';
        defaultPayroll = 600000;
        break;
      case 'Housekeeping':
        defaultPassword = 'housekeeping@123';
        defaultPayroll = 500000;
        break;
      case 'Chef':
        defaultPassword = 'chef@123';
        defaultPayroll = 700000;
        break;
      case 'Others':
        defaultPassword = 'other@123';
        defaultPayroll = 600000;
        break;
    }

    passwordInput.value = defaultPassword;
    payrollInput.value = defaultPayroll;
  });

  // Edit Staff modal auto-fill
  const editRoleSelect = document.getElementById('editStaffRole');
  const editPasswordInput = document.getElementById('editStaffPassword');
  const editPayrollInput = document.getElementById('editPayRoll');

  editRoleSelect.addEventListener('change', function() {
    const role = this.value;
    let defaultPassword = '';
    let defaultPayroll = '';

    switch (role) {
      case 'Manager':
        defaultPassword = 'manager@123';
        defaultPayroll = 800000;
        break;
      case 'Receptionist':
        defaultPassword = 'receptionist@123';
        defaultPayroll = 600000;
        break;
      case 'Housekeeping':
        defaultPassword = 'housekeeping@123';
        defaultPayroll = 500000;
        break;
      case 'Chef':
        defaultPassword = 'chef@123';
        defaultPayroll = 700000;
        break;
      case 'Others':
        defaultPassword = 'other@123';
        defaultPayroll = 600000;
        break;
    }

    editPasswordInput.value = defaultPassword;
    editPayrollInput.value = defaultPayroll;
  });
});
</script>
