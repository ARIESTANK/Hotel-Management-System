{% include './header.html' %}

<style>
  body {
    background-color: #f8f9fa;
    font-family: 'Segoe UI', sans-serif;
  }

  .profile-header {
    background-color: #0d6efd;
    color: #fff;
    padding: 50px 20px 30px;
    border-radius: 0 0 30px 30px;
    text-align: center;
    position: relative;
}

/* Make profile picture overlay smaller on mobile */
.profile-header img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 4px solid #fff;
    object-fit: cover;
    position: absolute;
    bottom: -60px; /* reduced for smaller screen */
    left: 50%;
    transform: translateX(-50%);
}

.profile-body {
    margin-top: 60px; /* reduce extra space */
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 30px;
}

/* Mobile adjustments */
@media(max-width: 576px){
    .profile-header img {
        width: 100px;
        height: 100px;
        /* position: */
        margin-left: -15%;
        bottom: auto;
        transform: none;
        margin-top: -30px; /* less aggressive overlap */
        /* Or keep it as 'margin-top: 0;' and rely on the body margin */
    }
    .profile-body {
        margin-top: -20px; /* Adjust based on image overlap */
        padding: 20px;
    }
}

</style>

<body>
  <!-- Profile Header -->
  <div class="profile-header my-5">
    <h2 class="my-5">Guest Profile</h2>
    <img id="profile-picture" src="" alt="Profile Picture">
  </div>

  <!-- Profile Body -->
  <div class="profile-body">
    <div class="profile-info">
        <h3 id="guest-name" class="mb-3">Guest Name</h3> 
        <p><strong>Email:</strong> <span id="guest-email">guest@example.com</span></p>
        <p><strong>NRC No:</strong> <span id="guest-nrc">12/ABC(N)123456</span></p>
        <p><strong>Phone:</strong> <span id="guest-phone">+1234567890</span></p>
        <p><strong>Address:</strong> <span id="guest-address">123 Main Street, City</span></p>
        <p><strong>Member Since:</strong> <span id="guest-joined">2025-01-01</span></p>
        <div class="d-grid gap-2 d-md-block mt-4">
            <button class="btn btn-primary btn-edit">Edit Profile</button>
            <a href="/logout"><button class="btn btn-danger btn-logout">Logout</button></a>
        </div>
    </div>


    <!-- Booking Summary -->
  <div class="container my-4">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold text-primary mb-0">
          <i class="bi bi-calendar-check me-2"></i>Booking History
        </h4>
        <span class="badge bg-light text-dark">
          Total: {{ bookings|length }}
        </span>
      </div>

      {% if bookings %}
      <div class="table-responsive">
        <table class="table table-hover align-middle text-center">
          <thead class="table-primary">
            <tr>
              <th>Booking ID</th>
              <th>Check-In</th>
              <th>Check-Out</th>
              <th>Guest Count</th>
              <th>Room Type</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in bookings %}
            <tr>
              <td class="fw-semibold text-secondary">#{{ booking.bookingID }}</td>
              <td>{{ booking.checkIn }}</td>
              <td>{{ booking.checkOut }}</td>
              <td>{{ booking.guestCount }}</td>
              <td>{{booking.roomType}}</td>
              {% if booking.roomID %}
              <td><span class="badge bg-success">Accepted</span></td>
              {% else %}
              <td><span class="badge bg-warning">Pending</span></td>
              {% endif %}

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-4">
        <i class="bi bi-inbox text-secondary" style="font-size: 3rem;"></i>
        <p class="mt-3 text-muted">No bookings found</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
<div class="container my-4">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold text-primary mb-0">
          <i class="bi bi-calendar-check me-2"></i>Services History
        </h4>
        <span class="badge bg-light text-dark">
          Total: {{ orders|length }}
        </span>
      </div>

      {% if orders %}
      <div class="table-responsive">
        <table class="table table-hover align-middle text-center">
          <thead class="table-primary">
            <tr>
              <th>Order ID</th>
              <th>Item List</th>
              <th>Total Amount</th>
              <th>Order Time</th>
              <th>Status</th>
            </tr>
          </thead>
           <tbody>
      {% for order in orders %}
      <tr>
        <td class="fw-bold text-primary">#{{ order.orerID }}</td>

        <!-- Menu Items -->
        <td>
          <div class="d-flex flex-wrap gap-2">
            {% for item in order.menuItems %}
            <span class="badge bg-info text-dark p-2">{{ item.name }} x{{ item.qty }}</span>
            {% endfor %}
          </div>
        </td>
        <!-- Amount -->
        <td>${{ order.amount|floatformat:2 }}</td>
        <!-- Created At -->
        <td>{{ order.created_at|date:"M d, Y H:i" }}</td>

        <!-- Status (optional) -->
        <td>
          {% if order.status == "Accepted" %}
          <span class="badge bg-success">Accepted</span>
          {% elif order.status == "Pending" %}
          <span class="badge bg-warning text-dark">Pending</span>
          {% else %}
          <span class="badge bg-secondary">Unknown</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-4">
        <i class="bi bi-inbox text-secondary" style="font-size: 3rem;"></i>
        <p class="mt-3 text-muted">No bookings found</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
</div>
</body>

<script>
  async function loadGuestProfile() {
    try {
      // Replace with your guest API endpoint
      const response = await fetch('http://192.168.100.11:8000/api/authGuest');
      const data = await response.json();

      // Populate guest info
      document.getElementById('profile-picture').src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTV0zscYTnOxutaPDaZ9Un0Ak-y0yR8jw40qA&s';
      document.getElementById('guest-name').textContent = data.guestName;
      document.getElementById('guest-email').textContent = data.guestEmail;
      document.getElementById('guest-phone').textContent = data.guestPh;
      document.getElementById('guest-joined').textContent = data.created_at;
      document.getElementById('guest-nrc').textContent = data. guestNRC;
      document.getElementById('guest-address').textContent = data.Address;

    } catch (error) {
      console.error('Error loading guest profile:', error);
    }
  }

  window.addEventListener('DOMContentLoaded', loadGuestProfile);
</script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
