{% include './staffHeader.html' %}
<style>
body {
  background-color: #f8f9fa;
}

.table-container {
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  padding: 25px;
  margin-top: 40px;
}

/* Filter Bar */
.filter-bar select,
.filter-bar input {
  min-width: 120px;
  flex: 1 1 auto;
}

/* Buttons */
.btn-add {
  border-radius: 30px;
  padding: 8px 20px;
}

/* Modal Header */
.modal-header {
  background: #0d6efd;
  color: #fff;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .filter-bar {
    flex-direction: column;
    gap: 0.5rem;
  }
  .filter-bar select,
  .filter-bar input,
  .filter-bar button {
    width: 100% !important;
  }
  .table-container {
    padding: 15px;
  }
}
</style>

<body>
<div class="container mt-5">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
    <h2 class="fw-bold text-primary">üè® Room Management</h2>
    <button class="btn btn-primary btn-add" data-bs-toggle="modal" data-bs-target="#addRoomModal">
      <i class="bi bi-plus-circle"></i> Add Room
    </button>
  </div>

  <!-- üîç Filter Bar -->
  <form action="/filterRooms/" method="post">
    {% csrf_token %}
    <div class="filter-bar d-flex flex-wrap gap-2 mb-3">
      <select id="filterRoomType" name="roomType" class="form-select w-auto">
        <option value="">All Types</option>
        <option value="Standard">Standard</option>
        <option value="Deluxe">Deluxe</option>
        <option value="Suite">Suite</option>
        <option value="Premium">Premium</option>
      </select>

      <select id="filterStatus" name="status" class="form-select w-auto">
        <option value="">All Status</option>
        <option value="Free">Free</option>
        <option value="Booked">Booked</option>
        <option value="Served">Served</option>
      </select>

      <input type="number" name="accomodation" id="filterAccomodation" class="form-control w-auto" placeholder="Min accommodation">

      <button class="btn btn-outline-primary" id="applyFilter">Filter</button>
      <button type="button" class="btn btn-outline-secondary" id="resetFilter">Reset</button>
    </div>
  </form>

  <!-- Room Table -->
  <div class="table-container table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Building</th>
          <th>Room Code</th>
          <th>Room Type</th>
          <th>Accomodation</th>
          <th>Price</th>
          <th>Status</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody id="roomTableBody">
        {% for room in roomList %}
        <tr>
          <th scope="row">{{room.roomID}}</th>
          <td>{{room.building}}</td>
          <td>{{room.roomCode}}</td>
          <td>{{room.type}}</td>
          <td>{{room.accomodation}}</td>
          <td>{{room.price}}</td>
          {% if room.status == "Booked" %}
          <td><span class="badge bg-warning">{{room.status}}</span></td>
          {% elif room.status == "Unavailable" %}
          <td><span class="badge bg-danger">{{room.status}}</span></td>
          {% else %}
          <td><span class="badge bg-success">{{room.status}}</span></td>
          {% endif %}
          <td class="text-center">
            <button class="btn btn-success btn-sm mb-1 mb-md-0 editRoomBtn" 
                    data-bs-toggle="modal" 
                    data-bs-target="#editRoomModal"
                    data-id="{{room.roomID}}"
                    data-code="{{room.roomCode}}"
                    data-building="{{room.building}}"
                    data-accomodation="{{room.accomodation}}"
                    data-type="{{room.type}}"
                    data-price="{{room.price}}">
              <i class="bi bi-pencil-square"></i>
            </button>
            <a href="/deleteRoom/{{room.roomID}}/"><button class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></button></a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Add Room Modal -->
<div class="modal fade" id="addRoomModal" tabindex="-1" aria-labelledby="addRoomLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addRoomLabel">Add New Room</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form id="addRoomForm" action="/updateRoom/" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label fw-bold">Room Code</label>
             <input type="hidden" name="roomID" class="form-control" id="roomID">
            <input type="text" name="roomCode" class="form-control" placeholder="Enter Room Code" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Building</label>
            <input type="text" name="building" class="form-control" placeholder="Enter building" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Accomodation</label>
            <input type="number" name="accomodation" class="form-control" placeholder="Enter Accomodation" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Room Type</label>
            <select id="roomTypeSelect" name="roomType" class="form-select" required>
              <option value="">-- Select Room Type --</option>
              <option value="Standard">Standard</option>
              <option value="Deluxe">Deluxe</option>
              <option value="Suite">Suite</option>
              <option value="Premium">Premium</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Price (per night)</label>
            <input type="number" id="roomPrice" name="price" class="form-control" required>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Room</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Edit Room Modal -->
<div class="modal fade" id="editRoomModal" tabindex="-1" aria-labelledby="editRoomLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="editRoomLabel">Edit Room</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form id="editRoomForm" method="post" action="/updateRoom/">
        {% csrf_token %}
        <input type="hidden" name="roomID" id="editRoomID">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label fw-bold">Room Code</label>
            <input type="text" name="roomCode" id="editRoomCode" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Building</label>
            <input type="text" name="building" id="editBuilding" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Accomodation</label>
            <input type="number" name="accomodation" id="editAccomodation" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Room Type</label>
            <select name="roomType" id="editRoomType" class="form-select" required>
              <option value="">-- Select Room Type --</option>
              <option value="Standard">Standard</option>
              <option value="Deluxe">Deluxe</option>
              <option value="Suite">Suite</option>
              <option value="Premium">Premium</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Price (per night)</label>
            <input type="number" name="price" id="editRoomPrice" class="form-control" required>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Room</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Room type default prices
const roomPrices = {
  "Standard": 80,
  "Deluxe": 100,
  "Suite": 150,
  "Premium": 120,
};

const roomTypeSelect = document.getElementById("roomTypeSelect");
const roomPriceInput = document.getElementById("roomPrice");

roomTypeSelect.addEventListener("change", function() {
  const selectedType = this.value;
  roomPriceInput.value = roomPrices[selectedType] || "";
});

// Reset Filter
document.getElementById("resetFilter").addEventListener("click", () => {
  document.getElementById("filterRoomType").value = "";
  document.getElementById("filterStatus").value = "";
  document.getElementById("filterAccomodation").value = "";
  document.querySelectorAll("#roomTableBody tr").forEach(row => row.style.display = "");
});


const editButtons = document.querySelectorAll(".editRoomBtn");

editButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const roomID = btn.getAttribute("data-id");
    const code = btn.getAttribute("data-code");
    const building = btn.getAttribute("data-building");
    const accomodation = btn.getAttribute("data-accomodation");
    const type = btn.getAttribute("data-type");
    const price = btn.getAttribute("data-price");

    document.getElementById("editRoomID").value = roomID;
    document.getElementById('roomID').value=roomID;
    document.getElementById("editRoomCode").value = code;
    document.getElementById("editBuilding").value = building;
    document.getElementById("editAccomodation").value = accomodation;
    document.getElementById("editRoomType").value = type;
    document.getElementById("editRoomPrice").value = price;
  });
});

// Optional: auto update price when room type changes in edit modal
const editRoomTypeSelect = document.getElementById("editRoomType");
const editRoomPriceInput = document.getElementById("editRoomPrice");
const roomPrice = { "Standard": 80, "Deluxe": 100, "Suite": 150, "Premium": 120 };

editRoomTypeSelect.addEventListener("change", () => {
  const selectedType = editRoomTypeSelect.value;
  editRoomPriceInput.value = roomPrice[selectedType] || "";
});

</script>
